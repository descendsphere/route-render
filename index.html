<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>GPX 3D Player</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.134/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>

<div id="cesiumContainer"></div>

<div id="panel-container">
  <div id="side-panel">
    <div class="panel-header">
      <h1>GPX 3D Player</h1>
      <span id="panel-toggle-icon" class="toggle-icon">▾</span>
    </div>
    <div id="panel-content">
      <div id="route-library-group" class="control-group">
        <label for="route-library-select">Route Library</label>
        <select id="route-library-select">
          <!-- Options will be populated by UIManager.js -->
        </select>
      </div>

      <div class="control-group">
        <input type="file" id="gpx-file" accept=".gpx">
        <div class="url-input-group">
          <input type="text" id="gpx-url-input" placeholder="Or paste a GPX URL">
          <button id="load-from-url-btn">Load</button>
        </div>
      </div>

      <div id="tour-controls" class="control-group" style="display: none;">
        <h4>Tour</h4>
        <div class="tour-buttons">
          <button id="play-tour">Start Tour</button>
          <button id="stop-tour">Reset Tour</button>
          <button id="zoom-to-route">Zoom to Route</button>
          <button id="reset-style">Reset Style</button>
        </div>
        <div class="slider-group">
          <label for="tour-speed">
            <svg class="icon-speed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
            <span class="label-text">Speed:</span>
          </label>
          <input type="range" id="tour-speed" min="0" max="100" step="1" value="50">
          <span id="speed-display">1.00x</span>
        </div>
      </div>

      <div id="camera-strategy-controls" class="control-group" style="display: none;">
        <h4>Camera</h4>
        <select id="camera-strategy">
          <option value="third-person">Third-Person</option>
          <option value="top-down">Top-Down</option>
          <option value="overhead" selected>Overhead</option>
        </select>
        <div class="slider-group">
          <label for="camera-distance">
            <svg class="icon-zoom" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <span class="label-text">Zoom:</span>
          </label>
          <input type="range" id="camera-distance" min="0" max="100" step="1" value="50">
          <span id="camera-distance-display">1000m</span>
        </div>
        <div class="slider-group">
          <label for="camera-pitch">
            <svg class="icon-pitch" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>
            <span class="label-text">Pitch:</span>
          </label>
          <input type="range" id="camera-pitch" min="-90" max="0" step="1" value="-45">
          <span id="camera-pitch-display">-45°</span>
        </div>
      </div>

      <div id="performance-controls" class="control-group" style="display: none;">
        <h4>Performance</h4>
        <div class="control-section">
          <label for="performance-profile">Profile</label>
          <select id="performance-profile">
            <option value="Performance">Performance</option>
            <option value="Balanced" selected>Balanced</option>
            <option value="Power Saver">Power Saver</option>
          </select>
        </div>
      </div>

      <div id="style-controls" class="control-group" style="display: none;">
          <h4>Style</h4>
          <div>
            <h5>Route</h5>
            <div class="inline-controls">
              <div class="color-input-group">
                <label for="route-color">Color:</label>
                <input type="color" id="route-color" value="#FFA500">
              </div>
              <div class="number-input-group">
                <label>Width:</label>
                <div class="number-input-widget">
                  <button id="route-width-decrement" class="adjust-button">-</button>
                  <span id="route-width-display">5</span>
                  <button id="route-width-increment" class="adjust-button">+</button>
                </div>
              </div>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="clamp-to-ground" checked>
              <label for="clamp-to-ground">Clamp to Ground</label>
            </div>
          </div>
          <div id="person-style-controls">
            <h5>Person</h5>
            <div class="inline-controls">
              <div class="color-input-group">
                <label for="person-color">Color:</label>
                <input type="color" id="person-color" value="#FFA500">
              </div>
              <div class="number-input-group">
                <label>Size:</label>
                <div class="number-input-widget">
                  <button id="person-size-decrement" class="adjust-button">-</button>
                  <span id="person-size-display">1</span>
                  <button id="person-size-increment" class="adjust-button">+</button>
                </div>
              </div>
            </div>
          </div>
      </div>

      <div id="route-stats" class="control-group" style="display: none;">
        <h4>Statistics</h4>
        <div id="stats-content"></div>
      </div>

      <div id="filename-suggestion" class="control-group" style="display: none;">
        <h4>Suggested Filename</h4>
        <p id="filename-content" style="word-wrap: break-word;"></p>
      </div>

      <div id="advanced-controls" class="control-group">
        <h4 class="collapsible-header">Advanced</h4>
        <div class="collapsible-content">
          <button id="clear-storage-button">Clear All Stored Data</button>
        </div>
      </div>
    </div>
  </div>
  <div id="quick-controls-container">
    <!-- Vertical sliders will be moved here by JS -->
  </div>
</div>

<div id="loading-indicator" style="display: none;">
  <div class="spinner"></div>
  <p>Loading...</p>
</div>

<div id="custom-tour-controls">
  <div class="scrubber-row">
    <div class="time-display" id="custom-time-display">00:00:00</div>
    <input type="range" id="custom-time-scrubber" min="0" max="1000" value="0" step="1" class="time-scrubber">
  </div>
  <div class="button-row">
    <button id="custom-rewind-btn" title="Toggle Direction">
      <svg class="icon-rewind" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 19 2 12 11 5 11 19"/><polygon points="22 19 13 12 22 5 22 19"/></svg>
      <svg class="icon-fast-forward" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 19 22 12 13 5 13 19"/><polygon points="2 19 11 12 2 5 2 19"/></svg>
    </button>
    <button id="custom-play-pause-btn" title="Play/Pause">
      <svg class="icon-play" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
      <svg class="icon-pause" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
    </button>
    <button id="custom-reset-btn" title="Reset Tour">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><polyline points="23 20 23 14 17 14"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>
    </button>
    <button id="custom-zoom-btn" title="Zoom to Route">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
    </button>
    <button id="custom-reset-style-btn" title="Reset Style">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
    </button>
    <button id="custom-poi-toggle-btn" title="Toggle POIs">
      <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
      <svg class="icon-eye-off" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.54 18.54 0 0 1 2.21-3.02m4.63-4.63A10.07 10.07 0 0 1 12 4c7 0 11 8 11 8a18.54 18.54 0 0 1-2.21 3.02m-4.63 4.63L12 9a3 3 0 0 0-3-3m-2.07 2.07L12 15a3 3 0 0 0 3 3"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
    </button>
  </div>
</div>

<script src="https://cesium.com/downloads/cesiumjs/releases/1.134/Build/Cesium/Cesium.js"></script>
<script src="https://unpkg.com/gpxparser@3.0.8/dist/GPXParser.min.js"></script>
<script src="https://unpkg.com/loglevel/dist/loglevel.min.js"></script>
<script type="module" src="app.js"></script>

</body>
</html>